trigger:
  - master
  - refs/tags/*

pr:
  - master
  
variables:
  BUILD_NUMBER: $(Build.BuildNumber)
  BUILD_COMMIT: $(Build.SourceVersion)
  PRE_RESTORE_PROJECTS: true  # Windows is having an issue on CI right now
#   XAMARIN_ANDROID_PATH: <path to Xamarin.Android>

  SIGNING_VM_NAME: VSEng-MicroBuildVS2019
  SIGNING_TYPE: Test
  SIGNING_TEAM_NAME: Xamarin
  SIGNING_ARTIFACT_NAME: nuget

resources:
  repositories:
    - repository: internal-templates
      type: github
      name: xamarin/yaml-templates
      endpoint: xamarin
      ref: refs/heads/mattleibow/v2-sign-artifacts
    - repository: components
      type: github
      name: xamarin/XamarinComponents
      endpoint: xamarin

jobs:
  - job: test_sign
    pool:
      name: $(SIGNING_VM_NAME)
      demands: 
        - msbuild

    steps:
      - checkout: none

      - task: DownloadBuildArtifacts@0
        displayName: 'Download Unsigned Artifacts'
        inputs:
          buildType: specific
          buildVersionToDownload: specific
          downloadType: single
          project: $(System.TeamProjectId)
          pipeline: $(System.DefinitionId)
          buildId: 4050789 # HACK FOR TESTING $(Build.BuildId)
          downloadPath: '$(Build.ArtifactStagingDirectory)\unsigned'
          artifactName: 'nuget'

      - ${{ if eq(variables['System.TeamProject'], 'devdiv') }}:
        - template: sign-artifacts/jobs/v2.yml@internal-templates
